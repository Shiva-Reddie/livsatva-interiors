RewriteEngine On

# Redirect HTTP to HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Custom 404 page
ErrorDocument 404 /404.php

# Redirect requests with .php to extensionless URL
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/([^.]+)\.php [NC]
RewriteRule ^([^.]+)\.php$ /%1 [R=301,L]

# Remove .php extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([a-zA-Z0-9_-]+)$ $1.php [L]

# Block access to .git directory and related files
RedirectMatch 403 ^/.*/\.git

# Block hidden/config files
<FilesMatch "^\.env|\.htaccess|\.htpasswd|composer\.(json|lock)|package\.json$">
    Require all denied
</FilesMatch>

# Block backup/config/dump files
<FilesMatch "(\.bak|\.sql|\.ini|\.log|\.old|\.orig|\.swp|~)$">
    Require all denied
</FilesMatch>

# Block known malicious scripts
<FilesMatch "404javascript\.js|404testpage.*|sk-jspark_init\.php">
    Require all denied
</FilesMatch>
